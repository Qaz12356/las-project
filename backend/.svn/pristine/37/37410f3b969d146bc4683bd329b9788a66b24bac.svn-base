<template>
    <el-row style="height: 60px;display: flex;align-items: center;padding: 4px;">
        <el-col :span="18">
            <el-form :model="queryForm" :inline="true">
                <el-form-item label="月份" :label-width="80">
                    <el-input v-model="queryForm.lostDate" placeholder="月份" style="width: 200px;" />
                </el-form-item>
            </el-form>
        </el-col>
        <el-col :span="6">
            <el-button type="primary" @click="queryPage()">查询</el-button>
        </el-col>
    </el-row>
    <el-row>
        <el-col :span="24">
            <div style="width: 100%; text-align: center;">
                <div id="typepie" style="width: 80%;margin-left: auto;margin-right: auto;height: 600px;">

                </div>
            </div>
        </el-col>
    </el-row>
</template>

<script setup>
import * as echarts from 'echarts';
import {
    onMounted,
    reactive
} from 'vue';

let queryForm = reactive({
    lostDate: 4
})

import {
    queryLostTypeSs
} from "@/apis/lost.js"


function queryPage() {
    queryLostTypeSs(queryForm.lostDate).then(res => {
        // console.log(res)
        displayPie(queryForm.lostDate, res)
    })
}


function displayPie(lostDate, typedata) {
    var chartDom = document.getElementById('typepie');
    var myChart = echarts.getInstanceByDom(chartDom);
    if (myChart) {
        myChart.dispose();
    }
    myChart = echarts.init(chartDom);
    console.log('传入的月份:', lostDate);
    console.log('后端返回的数据:', typedata);
    var option;

    option = {
        title: {
            text: '失物类型情况',
            subtext: lostDate,
            left: 'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: '{a} <br/>{b}: {c} ({d}%)'
        },
        legend: {
            orient: 'vertical',
            left: 'left'
        },
        series: [{
            name: '失物类型',
            type: 'pie',
            radius: '50%',
            data: typedata.map(item => ({
                value: item.value,
                name: item.lostTypeName
            })),
            label: {
                show: true,
                formatter: '{b}: {c}'
            },
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }]
    };

    option && myChart.setOption(option);
}

onMounted(() => {
    queryPage();
})
</script>

<style scoped>
</style>    